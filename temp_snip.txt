      revenueByProduct,
      priceEvolution,
      priceEvolutionByProduct,
      productNames,
      productMix,
      topClientsPerProduct,
    }
  }

  const calculateRegionAnalytics = () => {
    if (!filteredSales || filteredSales.length === 0 || !clients || clients.length === 0) {
      return {
        revenueByRegion: [],
        clientsByRegion: [],
        avgTicketByRegion: [],
        topRegions: [],
        topProductsByRegion: [],
      }
    }

    const validSales = filteredSales
    const regionRevenue = {}
    const regionClients = {}

    validSales.forEach((sale) => {
      const clientId = sale.clientId || sale.clienteId
      const client = clients.find((c) => c.id === clientId)
      const region = client?.state || "Não informado"

      const revenue = Number(sale.valorTotal) || Number(sale.total) || 0
      regionRevenue[region] = (regionRevenue[region] || 0) + revenue

      if (!regionClients[region]) {
        regionClients[region] = new Set()
      }
      regionClients[region].add(clientId)
    })

    // Revenue by region
    const revenueByRegion = Object.entries(regionRevenue)
      .sort(([, a], [, b]) => b - a)
      .map(([region, revenue]) => ({
        regiao: region,
        faturamento: revenue,
      }))

    // Clients by region
    const clientsByRegion = Object.entries(regionClients).map(([region, clientSet]) => ({
      regiao: region,
      clientes: clientSet.size,
    }))

    // Avg ticket by region
    const avgTicketByRegion = Object.entries(regionRevenue).map(([region, revenue]) => ({
      regiao: region,
      ticket: regionClients[region] ? revenue / regionClients[region].size : 0,
    }))

    // Top regions
    const topRegions = revenueByRegion.slice(0, 5)

    return {
      revenueByRegion,
      clientsByRegion,
      avgTicketByRegion,
      topRegions,
      topProductsByProductByRegion: [],
    }
  }

  const clientAnalytics = calculateClientAnalytics()
  // Ajusta página quando a lista muda
  useEffect(() => {
    const total = clientAnalytics?.inactiveClients?.length || 0
    const pages = Math.max(1, Math.ceil(total / 5))
    if (inactivePage > pages) setInactivePage(pages)
  }, [clientAnalytics?.inactiveClients?.length])
  const productAnalytics = calculateProductAnalytics()
  const regionAnalytics = calculateRegionAnalytics()

  const COLORS = ["#25BE8C", "#2a9d8f", "#3b82f6", "#8b5cf6", "#f59e0b"]
  const RADIAN = Math.PI / 180
  const renderOuterLabel = ({ cx, cy, midAngle, outerRadius, percent }) => {
    if (percent < 0.05) return null
    const radius = outerRadius + 18
    const x = cx + radius * Math.cos(-midAngle * RADIAN)
    const y = cy + radius * Math.sin(-midAngle * RADIAN)
